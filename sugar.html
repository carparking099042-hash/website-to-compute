<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>Sugargame</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* ---------- Cute Red Theme (compact) ---------- */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: "Noto Sans Thai", "Poppins", system-ui, sans-serif;
      background: radial-gradient(circle at 10% 10%, #fff6f8 0%, #fff0f3 25%, #ffe6ec 60%);
      color:#4b0a0a;padding:18px;
    }
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,#ff2d55,#ff6b6b);display:flex;align-items:center;justify-content:center;color:#fff;font-size:28px;box-shadow:0 8px 20px rgba(255,45,85,0.14)}
    h1{font-size:20px;color:#fff;text-shadow:0 6px 18px rgba(255,45,85,0.12)}
    .subtitle{font-size:12px;color:rgba(255,255,255,0.9);background:rgba(0,0,0,0.06);display:inline-block;padding:4px 8px;border-radius:999px}
    nav{display:flex;gap:12px;align-items:center}
    .btn{background:linear-gradient(180deg,#fff 0%, #ffeef5 100%);border-radius:12px;padding:8px 12px;border:0;color:#ff2d55;font-weight:700;cursor:pointer;box-shadow:0 8px 18px rgba(255,45,85,0.08)}
    .btn.ghost{background:transparent;border:2px solid rgba(255,255,255,0.12)}
    .btn.danger{background:linear-gradient(90deg,#ff2d55,#ff6b6b);color:white}
    .main{display:grid;grid-template-columns:1fr 340px;gap:18px}
    .card{background:rgba(255,255,255,0.92);padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(200,40,80,0.06);margin-bottom:12px}
    .items{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .item{background:white;border-radius:12px;padding:10px;border:2px solid rgba(255,45,85,0.05);display:flex;flex-direction:column;gap:8px}
    .item h4{color:#ff2d55}
    .item p{font-size:13px;color:#6b2222}
    .item-row{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
    .price{font-weight:900;color:#b00020}
    .avatar{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#fff 0%, #ffdfe3);display:flex;align-items:center;justify-content:center;color:#ff2d55;font-weight:900}
    .muted{color:#7a2b2b;font-size:13px}
    footer{text-align:center;margin-top:18px;color:#7a2b2b;font-size:13px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,10,10,0.45);z-index:50;padding:18px}
    .modal-box{width:100%;max-width:760px}
    .modal-content{background:white;padding:14px;border-radius:12px;color:#4b0a0a}
    .modal-content input,.modal-content textarea{width:100%;padding:8px;margin-top:8px;border-radius:8px;border:1px solid rgba(176,0,32,0.08)}
    .items img{border-radius:8px; width:100%; height:120px; object-fit:cover; border:4px solid #fff}
    @media(max-width:980px){ .main{grid-template-columns:1fr} .items{grid-template-columns:repeat(2,1fr)} }
    @media(max-width:560px){ .items{grid-template-columns:1fr} header{flex-direction:column;align-items:flex-start;gap:8px} }
    /* small helpers */
    .row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px}
    .danger-text{color:#b00020;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">üç¨</div>
        <div>
          <h1>Sugargame</h1>
          <div class="subtitle">‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‚Äî ‡∏ò‡∏µ‡∏°‡πÅ‡∏î‡∏á</div>
        </div>
      </div>
      <nav>
        <div id="greet" class="small">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, Guest</div>
        <div style="display:flex;gap:8px;margin-left:12px">
          <button class="btn" id="btnLogin">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô/‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
          <button class="btn" id="btnProfile">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
        </div>
      </nav>
    </header>

    <main class="main">
      <section>
        <div class="card">
          <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Sugargame üéÄ</h2>
          <p class="muted">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö Frontend-only ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (localStorage). ‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå AI-assist ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÅ‡∏ö‡∏ö‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å.</p>
        </div>

        <div class="card">
          <h3>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</h3>
          <div id="itemsWrap" class="items" style="margin-top:10px"></div>
        </div>
      </section>

      <aside>
        <div class="card">
          <div style="display:flex;gap:12px;align-items:center">
            <div class="avatar" id="avatar">SG</div>
            <div>
              <div id="usernameDisplay">Guest</div>
              <div class="muted" id="creditDisplay">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: -</div>
            </div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-direction:column">
            <button class="btn" id="btnTopup">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</button>
            <button class="btn ghost" id="btnSeed">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <div class="muted small">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: <strong>sugargame_admin</strong> / <strong>admin123</strong></div>
          </div>
        </div>

        <div class="card" id="adminPanel" style="display:none">
          <h4>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h4>
          <button class="btn danger" id="btnOpenAdmin">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
        </div>
      </aside>
    </main>

    <footer>¬© Sugargame ‚Äî ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</footer>
  </div>

  <!-- modal -->
  <div id="modal" class="modal"><div class="modal-box"><div id="modalContent" class="modal-content"></div></div></div>

<script>
/*
  Sugargame ‚Äî Frontend-only with AI-assisted description generator (mock)
  localStorage keys:
    - sg_data : { users:[], items:[], orders:[], nextUserId, nextItemId, nextOrderId }
    - sg_session : { userId, username, role }
*/

// helper funcs
const $ = s=>document.querySelector(s);
const lsGet = k => JSON.parse(localStorage.getItem(k) || 'null');
const lsSet = (k,v)=>localStorage.setItem(k, JSON.stringify(v));
const now = ()=>new Date().toISOString();

// default seed
function defaultSeed(){
  const users = [
    { id:1, username:'sugargame_admin', password:'admin123', credit:0, role:'admin' },
    { id:2, username:'player001', password:'pass123', credit:200, role:'user' }
  ];
  const items = [
    { id:1, title:'Starter Pack - 100 Gems', desc:'ID level 10 +100 gems. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: user_xxx / pass_yyy', price:100, image:null, owner:'sugargame_admin' },
    { id:2, title:'Pro Sword', desc:'‡∏î‡∏≤‡∏ö‡∏´‡∏≤‡∏¢‡∏≤‡∏Å ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: sword_user / 1234', price:300, image:null, owner:'sugargame_admin' },
    { id:3, title:'Skin Bundle', desc:'‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏Å‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: skin_acc / skinpass', price:200, image:null, owner:'sugargame_admin' },
    { id:4, title:'VIP Account', desc:'‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏™‡∏π‡∏á VIP. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: vip_user / vip123', price:1000, image:null, owner:'sugargame_admin' },
    { id:5, title:'Lucky Chest', desc:'‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á (‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏≤‡∏Å). ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: lucky / 555', price:50, image:null, owner:'sugargame_admin' }
  ];
  return { users, items, orders:[], nextUserId:3, nextItemId:6, nextOrderId:1 };
}

// ensure data exist
function ensureData(){
  let d = lsGet('sg_data');
  if(!d){ d = defaultSeed(); lsSet('sg_data', d); }
  return d;
}

// session
function getSession(){ return lsGet('sg_session'); }
function setSession(s){ lsSet('sg_session', s); render(); }
function clearSession(){ localStorage.removeItem('sg_session'); render(); }

// render UI
function render(){
  const s = getSession();
  const d = ensureData();
  $('#greet').textContent = s ? `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${s.username}` : '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, Guest';
  if(s){
    $('#avatar').textContent = s.username.slice(0,2).toUpperCase();
    $('#usernameDisplay').textContent = s.username + (s.role==='admin' ? ' (Admin)' : '');
    const u = d.users.find(x=>x.id===s.userId);
    $('#creditDisplay').textContent = '‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: ' + (u?u.credit:'-');
  } else {
    $('#avatar').textContent = 'SG';
    $('#usernameDisplay').textContent = 'Guest';
    $('#creditDisplay').textContent = '‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: -';
  }
  // admin panel
  if(s && s.role==='admin') $('#adminPanel').style.display='block'; else $('#adminPanel').style.display='none';
  // items
  const wrap = document.getElementById('itemsWrap'); wrap.innerHTML='';
  d.items.forEach(it=>{
    const el = document.createElement('div'); el.className='item';
    const img = document.createElement('img'); img.src = it.image || `data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="600" height="300"><rect width="100%" height="100%" fill="%23fff0f3"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="28" fill="%23ff2d55">'+escapeHtml(it.title)+'</text></svg>')}`;
    el.appendChild(img);
    const h = document.createElement('h4'); h.textContent = it.title; el.appendChild(h);
    const p = document.createElement('p'); p.textContent = it.desc; el.appendChild(p);
    const row = document.createElement('div'); row.className='item-row';
    row.innerHTML = `<div class="price">${it.price} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</div><button class="btn buy">‡∏ã‡∏∑‡πâ‡∏≠</button>`;
    row.querySelector('.buy').onclick = ()=> buyItem(it.id);
    el.appendChild(row);
    wrap.appendChild(el);
  });
}

// utilities
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }
function openModal(html){ $('#modalContent').innerHTML = html; $('#modal').style.display='flex'; }
function closeModal(){ $('#modal').style.display='none'; $('#modalContent').innerHTML=''; }

// auth
function openAuth(){
  openModal(`
    <div>
      <h3>‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h3>
      <form id="authForm">
        <input name="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required />
        <input name="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" type="password" required />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" type="submit">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</button>
          <button class="btn ghost" type="button" id="regBtn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
          <button class="btn ghost" type="button" id="closeAuth">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </form>
    </div>
  `);
  $('#authForm').onsubmit = (e)=>{
    e.preventDefault();
    const u = e.target.username.value.trim(), p = e.target.password.value.trim();
    const d = ensureData();
    const user = d.users.find(x=>x.username===u && x.password===p);
    if(!user){ alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î'); return; }
    setSession({ userId:user.id, username:user.username, role:user.role }); closeModal(); alert('‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  };
  $('#regBtn').onclick = ()=>{
    const u = $('#authForm [name="username"]').value.trim(), p = $('#authForm [name="password"]').value.trim();
    if(!u||!p){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'); return; }
    const d = ensureData();
    if(d.users.find(x=>x.username.toLowerCase()===u.toLowerCase())){ alert('‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß'); return; }
    const id = d.nextUserId++;
    d.users.push({ id, username:u, password:p, credit:0, role:'user' });
    lsSet('sg_data', d); alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
  };
  $('#closeAuth').onclick = closeModal;
}

// topup
function openTopup(){
  const s = getSession(); if(!s){ openAuth(); return; }
  openModal(`<div><h3>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (mock)</h3><form id="topupForm"><input name="amt" type="number" min="1" value="100"><div style="display:flex;gap:8px;margin-top:8px"><button class="btn" type="submit">‡πÄ‡∏ï‡∏¥‡∏°</button><button class="btn ghost" id="closeTop" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div></form></div>`);
  $('#topupForm').onsubmit = (e)=>{ e.preventDefault(); const v = Number(e.target.amt.value)||0; const s = getSession(); if(!s){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô'); closeModal(); return; } const d = ensureData(); const idx = d.users.findIndex(x=>x.id===s.userId); d.users[idx].credit += Math.max(1,v); lsSet('sg_data', d); closeModal(); render(); alert('‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); };
  $('#closeTop').onclick = closeModal;
}

// buy
function buyItem(itemId){
  const s = getSession(); if(!s){ openAuth(); return; }
  const d = ensureData();
  const userIdx = d.users.findIndex(x=>x.id===s.userId);
  const it = d.items.find(x=>x.id===itemId);
  if(!it){ alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°'); return; }
  if(d.users[userIdx].credit < it.price){ if(confirm('‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏´‡∏°?')) openTopup(); return; }
  d.users[userIdx].credit -= it.price;
  const oid = d.nextOrderId++;
  d.orders.unshift({ id:oid, userId:s.userId, itemId:it.id, status:'completed', delivered: it.desc, createdAt: now() });
  lsSet('sg_data', d); render(); alert('‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
}

// admin dashboard
function openAdmin(){
  const s = getSession(); if(!s || s.role!=='admin'){ alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô'); return; }
  const d = ensureData();
  const usersRows = d.users.map(u=>`<tr><td>${escapeHtml(u.username)}</td><td>${u.credit}</td><td>${u.role}</td><td><form class="adj" data-uid="${u.id}"><input name="amt" value="100"/><button class="btn" type="submit">‡∏õ‡∏£‡∏±‡∏ö</button></form></td></tr>`).join('');
  const itemsRows = d.items.map(it=>`<tr><td>${escapeHtml(it.title)}</td><td>${it.price}</td><td>${escapeHtml(it.owner)}</td></tr>`).join('');
  const ordersRows = d.orders.map(o=>`<li>#${o.id} ‚Ä¢ ${escapeHtml(d.users.find(x=>x.id===o.userId)?.username||'‚Äî')} ‚Ä¢ ${escapeHtml(d.items.find(x=>x.id===o.itemId)?.title||'‚Äî')} ‚Ä¢ ${o.status}</li>`).join('');
  openModal(`<div><h3>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
    <div style="display:flex;gap:12px">
      <div style="flex:1">
        <h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏° (‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢)</h4>
        <form id="addItemForm">
          <input name="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏≤‡∏ö‡πÅ‡∏™‡∏á)" required />
          <input name="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï)" type="number" required />
          <textarea name="desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠)" ></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
            <button class="btn ghost" id="genAI" type="button">Generate with AI</button>
            <button class="btn ghost" id="closeAdd" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        </form>
        <h4 style="margin-top:12px">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</h4>
        <table><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</th></tr></thead><tbody>${itemsRows}</tbody></table>
      </div>
      <div style="width:320px">
        <h4>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h4><table><thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</th><th>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th><th>‡∏õ‡∏£‡∏±‡∏ö</th></tr></thead><tbody>${usersRows}</tbody></table>
        <h4 style="margin-top:10px">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h4><ul>${ordersRows}</ul>
      </div>
    </div>
    <div style="margin-top:10px"><button class="btn ghost" id="closeAdmin">‡∏õ‡∏¥‡∏î</button></div></div>`);
  // handlers
  $('#addItemForm').onsubmit = (e)=>{ e.preventDefault(); const t=e.target.title.value.trim(), p=Number(e.target.price.value)||0, desc=e.target.desc.value.trim(); if(!t||p<=0){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; } const d=ensureData(); const id=d.nextItemId++; d.items.push({id,title:t,desc,price:p,image:null,owner:s.username}); lsSet('sg_data', d); render(); closeModal(); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); };
  $('#genAI').onclick = ()=>{ // AI-assisted generator (mock) -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠+‡∏£‡∏≤‡∏Ñ‡∏≤
    const title = $('#addItemForm [name="title"]').value.trim(); const price = $('#addItemForm [name="price"]').value.trim();
    const suggestion = aiGenerateDescription(title, price);
    $('#addItemForm [name="desc"]').value = suggestion;
  };
  document.querySelectorAll('.adj').forEach(f=>{ f.onsubmit = (ev)=>{ ev.preventDefault(); const uid=Number(f.dataset.uid), amt=Number(f.amt.value)||0; const d=ensureData(); const i=d.users.findIndex(x=>x.id===uid); if(i>=0){ d.users[i].credit += amt; lsSet('sg_data', d); render(); alert('‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); closeModal(); } }; });
  $('#closeAdd').onclick = closeModal; $('#closeAdmin').onclick = closeModal;
}

// mock AI generator function (‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á) ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
function aiGenerateDescription(title, price){
  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ title -> ‡∏Ñ‡∏∑‡∏ô template ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
  if(!title) return "‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©! ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô";
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô: ‡πÄ‡∏û‡∏¥‡πà‡∏° emoji, effect, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  const emojis = ['‚ú®','üíñ','‚öîÔ∏è','üõ°Ô∏è','üåü','üéÅ','üî•'];
  const e = emojis[Math.floor(Math.random()*emojis.length)];
  const ppart = price ? `‡∏£‡∏≤‡∏Ñ‡∏≤ ${price} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï` : '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å';
  // ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
  const desc = `${e} ${title} ‚Äî ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å Sugargame!\n${ppart} ‚Ä¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏™‡πà/‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤\n‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏ä‡∏Ñ/‡∏û‡∏•‡∏±‡∏á/‡∏™‡πÄ‡∏ï‡∏ï‡∏±‡∏™ (‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏Å‡∏°)\n‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏ô‡∏∏‡∏Å‡∏ô‡∏∞‡∏Ñ‡∏∞! üíï`;
  return desc;
}

// seed reset
function seedReset(){
  if(!confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?')) return;
  localStorage.removeItem('sg_data'); localStorage.removeItem('sg_session'); ensureData(); render(); alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
}

// event attach
document.addEventListener('click', (e)=> {
  if(e.target.matches('#btnLogin')) openAuth();
  if(e.target.matches('#btnTopup')) openTopup();
  if(e.target.matches('#btnSeed')) seedReset();
  if(e.target.matches('#btnOpenAdmin')) openAdmin();
  if(e.target.matches('#btnProfile')) openProfile();
  if(e.target.matches('#modal')) { if(e.target===document.getElementById('modal')) closeModal(); }
});

// profile modal
function openProfile(){
  const s = getSession(); if(!s){ openAuth(); return; }
  const d = ensureData(); const u = d.users.find(x=>x.id===s.userId);
  const myOrders = d.orders.filter(o=>o.userId===s.userId);
  const ordHtml = myOrders.map(o=>`<div style="padding:8px;border-radius:8px;background:#fff7f7;margin-bottom:8px"><b>${escapeHtml(d.items.find(i=>i.id===o.itemId)?.title||'‚Äî')}</b><div class="muted">${o.status} ‚Ä¢ ${o.createdAt.slice(0,19)}</div><details><summary>‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤</summary><pre>${escapeHtml(o.delivered)}</pre></details></div>`).join('')||'<div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>';
  openModal(`<div><h3>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‚Äî ${escapeHtml(u.username)}</h3><div class="muted">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: ${u.credit}</div><hr>${ordHtml}<div style="display:flex;gap:8px;margin-top:8px"><button class="btn" id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button><button class="btn ghost" id="closeProf">‡∏õ‡∏¥‡∏î</button></div></div>`);
  $('#logoutBtn').onclick = ()=>{ clearSession(); closeModal(); alert('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß'); };
  $('#closeProf').onclick = closeModal;
}

// initial
ensureData(); render();

// helpful: if admin account login, show admin open button in sidebar as well
if(getSession() && getSession().role==='admin'){ $('#adminPanel').style.display='block'; }
</script>
</body>
  </html>
